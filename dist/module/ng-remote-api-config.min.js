angular.module("ngRemoteApiConfig",["lodashAngularWrapper"]).factory("apiConfigService",function(a,b,c,d,e){"use strict";var f,g={};a.apiRoot?f=a.apiRoot:(f="http://fishlab8.digitalink.com",c.info("No API root in ENV, using default: ",f));var h=function(a){var f={method:"GET",cache:"false",withCredentials:"true",url:a+"/ui-json.json"};return b(f).then(function(b){var e={},f=b.data;if(c.debug("*** API CONFIG: for apiRoot:",a,f),!f)throw["*** ERROR API CONFIG: for apiRoot:"+a+" ui-json.txt is not available "];return e.services=d(f.services).mapValues(function(b){return a+b}).valueOf()||{},e.envName=f.envName||"na",e.urls=f.urls||{},e.options=f.options||{},{currentEnv:e,uiJson:f}}).then(function(a){var b=a.uiJson;return e.all(b.apiHosts?d(b.apiHosts).mapValues(function(a){return h(a)}).valueOf():null).then(function(b){return!b||d.isEmpty(b)?a.currentEnv:d(b).assign({currentEnv__:a.currentEnv}).reduce(function(a,b){return a.envName!==b.envName&&c.info("*** API CONFIG : the env names not fit:",a.envName,b.envName),a.services=d.assign(a.services||{},b.services||{}),a.urls=d.assign(a.urls||{},b.urls||{}),a.options=d.assign(a.options||{},b.options||{}),a})})})},i=null;return g.get=function(){return i=i||h(f)},g.getUrl=function(a){return a.url?e.when(a):g.get().then(function(b){var c=b.services[a.serviceName];if(!c)throw["*** API CONFIG: The service "+a.serviceName+" not found."];return a.url=b.services[a.serviceName]+a.resourcePath||"",a})},g.get().then(function(a){c.debug("*** API CONFIG retrieved:",a)}),g});